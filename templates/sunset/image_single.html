{% extends "base.html" %}
{% block title %}{% if image %}{{block.super}} - {{image}}{% else %}{{block.super}}{% endif %}{% endblock %}
{% block desc %}{% if image %}{{image.summary}}{% else %}{{block.super}}{% endif %}{% endblock %}

{% block content_left %}
	{% if image %}
		<div class="transbox photo_page"{% if assets.display %} style="max-width:{{assets.display.img_width}}px;"{% endif %}>
			{% if image.body %}
				<div id="photo_page_title">
					{% if can_edit %}
						<div id="photo_page_title_extra">
							<div class="hovericons16">
								<a href="?{{image.featured|yesno:'unfeature,feature'}}=1" title="{{image.featured|yesno:'Unfeature,Feature'}} this item"><img src="{{ STATIC_PREFIX }}images/icons/{{image.featured|yesno:',un'}}featured16.png" alt="{{image.featured|yesno:',Not '}}Featured" title="{{image.featured|yesno:',Not '}}Featured" /></a> 
								{% if image.scheduled %}
									<a href="?unpublish=1" title="Unpublish this item"><img src="{{ STATIC_PREFIX }}images/icons/publish-scheduled.png" alt="Scheduled - Will be published on {{image.timestamp_post|date:'F j, Y  G:i:s'}}" title="Scheduled - Will be published on {{image.timestamp_post|date:'F j, Y  G:i:s'}}" /></a> 
								{% else %}
									<a href="?{{image.published|yesno:'unpublish,publish'}}=1" title="{{image.published|yesno:'Unpublish,Publish'}} this item"><img src="{{ STATIC_PREFIX }}images/icons/publish-{{image.published|yesno:'on,off'}}.png" alt="{{image.published|yesno:',Not '}}Published" title="{{image.published|yesno:',Not '}}Published" /></a> 
								{% endif %}
								<a href="{% url 'admin:sunset_image_change' image.pk %}"><img src="{{ STATIC_PREFIX }}images/icons/edit.png" alt="Edit" title="Edit" /></a>
							</div>
							<span class="secondary_time">{{image.display_times.1.label}}:  {{image.display_times.1.timestamp|date:'F j, Y  G:i:s'}}</span>
						</div>
					{% endif %}

					<div id="photo_page_title_main"><h2>{{image}}</h2>
					<div id="byline">{{image.display_times.0.label}}:  {{image.display_times.0.timestamp|date:'F j, Y  G:i:s'}}</div>
					</div>
				</div>
			{% endif %}
			
			{% if assets.display %}
			<div class="photo_page_image">
				{% if assets.full %}<a href="{{assets.full.get_url}}" title="Full-Size View">{% endif %}<img src="{{assets.display.get_url}}" alt="{{image}}" title="{{image}}" />{% if assets.full %}</a>{% endif %}
			</div>
			{% endif %}
			
			{% if image.body %}
				<div class="photo_page_body">
					{% autoescape off %}
						{% if "<p>" in image.body or "<br />" in image.body %}
							{{image.body}}
						{% else %}
							{{image.body|linebreaks}}
						{% endif %}
					{% endautoescape %}
				</div>
			{% endif %}
			
			{% if image.geo_lat and image.geo_long %}
				<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.css" />
				<div class="photo_page_map">
					<div id="geotag_map" style="width: 100%; height: 250px;"></div>
					<script src="https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>
					<script>
						var mymap = L.map('geotag_map').setView([{{image.geo_lat}}, {{image.geo_long}}], 14);

						L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/outdoors-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibHVwaW5pYSIsImEiOiJjaXN1ejh4NDIwOXcxMnRvZGwwbWV6bnV1In0.TZWO35h5uvnlfnH9GtpJFQ', {
							maxZoom: 18,
							attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
								'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
								'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
							id: 'mapbox.streets'
						}).addTo(mymap);
						L.marker([{{image.geo_lat}}, {{image.geo_long}}]).addTo(mymap)
					</script>
				</div>
			{% endif %}
		</div>
	{% else %}
		<div class="transbox left_sidebar">
			{% load errors %}
			{% error_display error %}
		</div>
	{% endif %}
{% endblock %}

{% block content_right %}
	{% if image %}
		<div class="right_sidebar">
			{% comment %}<!-- Image Info -->{% endcomment %}
			{% if not image.body %}
				<div class="transbox right_sidebar_section photo_summary">
					<h3>{{image}}</h3>
					<div class="photo_sidebar_byline">
						<div id="byline">{{image.display_times.0.label}}:  {{image.display_times.0.timestamp|date:'F j, Y  G:i:s'}}</div>
						{% if can_edit %}
							<div id="photo_page_title_extra">
								<div class="hovericons16">
									<a href="?{{image.featured|yesno:'unfeature,feature'}}=1" title="{{image.featured|yesno:'Unfeature,Feature'}} this item"><img src="{{ STATIC_PREFIX }}images/icons/{{image.featured|yesno:',un'}}featured16.png" alt="{{image.featured|yesno:',Not '}}Featured" title="{{image.featured|yesno:',Not '}}Featured" /></a> 
									{% if image.scheduled %}
										<a href="?unpublish=1" title="Unpublish this item"><img src="{{ STATIC_PREFIX }}images/icons/publish-scheduled.png" alt="Scheduled - Will be published on {{image.timestamp_post|date:'F j, Y  G:i:s'}}" title="Scheduled - Will be published on {{image.timestamp_post|date:'F j, Y  G:i:s'}}" /></a> 
									{% else %}
										<a href="?{{image.published|yesno:'unpublish,publish'}}=1" title="{{image.published|yesno:'Unpublish,Publish'}} this item"><img src="{{ STATIC_PREFIX }}images/icons/publish-{{image.published|yesno:'on,off'}}.png" alt="{{image.published|yesno:',Not '}}Published" title="{{image.published|yesno:',Not '}}Published" /></a> 
									{% endif %}
									<a href="{% url 'admin:sunset_image_change' image.pk %}"><img src="{{ STATIC_PREFIX }}images/icons/edit.png" alt="Edit" title="Edit" /></a>
								</div>
							</div>
						{% endif %}
					</div>
					{% if image.summary %}<p>{{image.summary|safe}}</p>{% endif %}
				</div>
			{% endif %}
			
			{% comment %}<!-- Metadata -->{% endcomment %}
			{% if meta %}
				<div class="transbox right_sidebar_section">
					<h3>Metadata</h3>
					<ul class="photo_meta">
						{% for item in meta %}
							<li>
								<h5>{{item.key}}</h5>
								<div>{% if item.key.format_type == 'url' %}{{item.format_data|safe}}{% else %}{{item.format_data}}{% endif %}</div>
							</li>
						{% endfor %}
					</ul>
				</div>
			{% endif %}
			
			{% comment %}<!-- Tags -->{% endcomment %}
			{% if tags %}
				{% include 'deertrees/taglist_sidebar.html' %}
			{% endif %}
		</div>
	{% endif %}
{% endblock %}